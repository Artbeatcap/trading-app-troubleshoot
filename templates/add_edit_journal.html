{% extends "base.html" %}

{% block title %}{{ 'Edit' if journal else 'Add' }} Journal Entry - Options Plunge{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-book text-primary me-2"></i>
        {{ 'Edit' if journal else 'Add' }} Journal Entry
    </h1>
</div>

{% if show_login_prompt %}
<div class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i>
    You can add and manage your trading journal entries after logging in or creating an account.
    <div class="mt-2">
        <a href="{{ url_for('login') }}" class="btn btn-outline-primary btn-sm me-2">Log In</a>
        <a href="{{ url_for('register') }}" class="btn btn-outline-success btn-sm">Create Account</a>
    </div>
</div>
{% else %}
<form method="POST" class="needs-validation" novalidate>
    {{ form.hidden_tag() }}
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="journal_date" class="form-label">Date</label>
            {{ form.journal_date(class="form-control", required=true) }}
            {% if form.journal_date.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.journal_date.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-6 mb-3">
            <label for="daily_pnl" class="form-label">Daily P&L</label>
            {{ form.daily_pnl(class="form-control", type="number", step="0.01") }}
            {% if form.daily_pnl.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.daily_pnl.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mb-3">
        <label for="market_outlook" class="form-label">Morning Market Analysis</label>
        {{ form.market_outlook(class="form-control", rows=5) }}
        {% if form.market_outlook.errors %}
        <div class="invalid-feedback d-block">
            {% for error in form.market_outlook.errors %}
            {{ error }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="daily_goals" class="form-label">Daily Goals</label>
        {{ form.daily_goals(class="form-control", rows=5) }}
        {% if form.daily_goals.errors %}
        <div class="invalid-feedback d-block">
            {% for error in form.daily_goals.errors %}
            {{ error }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="what_went_well" class="form-label">What Went Well</label>
        {{ form.what_went_well(class="form-control", rows=5) }}
        {% if form.what_went_well.errors %}
        <div class="invalid-feedback d-block">
            {% for error in form.what_went_well.errors %}
            {{ error }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="what_went_wrong" class="form-label">What Went Wrong</label>
        {{ form.what_went_wrong(class="form-control", rows=5) }}
        {% if form.what_went_wrong.errors %}
        <div class="invalid-feedback d-block">
            {% for error in form.what_went_wrong.errors %}
            {{ error }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="lessons_learned" class="form-label">Key Lessons Learned</label>
        {{ form.lessons_learned(class="form-control", rows=5) }}
        {% if form.lessons_learned.errors %}
        <div class="invalid-feedback d-block">
            {% for error in form.lessons_learned.errors %}
            {{ error }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="mb-3">
        <label for="tomorrow_focus" class="form-label">Tomorrow's Focus</label>
        {{ form.tomorrow_focus(class="form-control", rows=5) }}
        {% if form.tomorrow_focus.errors %}
        <div class="invalid-feedback d-block">
            {% for error in form.tomorrow_focus.errors %}
            {{ error }}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="row mb-3">
        <div class="col-md-4">
            <label for="emotional_state" class="form-label">Emotional State</label>
            {{ form.emotional_state(class="form-select") }}
            {% if form.emotional_state.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.emotional_state.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-4">
            <label for="stress_level" class="form-label">Stress Level</label>
            {{ form.stress_level(class="form-select") }}
            {% if form.stress_level.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.stress_level.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-4">
            <label for="discipline_score" class="form-label">Discipline Score</label>
            {{ form.discipline_score(class="form-select") }}
            {% if form.discipline_score.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.discipline_score.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="market_trend" class="form-label">Overall Market Trend</label>
            {{ form.market_trend(class="form-select") }}
            {% if form.market_trend.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.market_trend.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-6">
            <label for="volatility" class="form-label">Market Volatility</label>
            {{ form.volatility(class="form-select") }}
            {% if form.volatility.errors %}
            <div class="invalid-feedback d-block">
                {% for error in form.volatility.errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="d-flex justify-content-between">
        <a href="{{ url_for('journal') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-1"></i>
            Back to Journal
        </a>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save me-1"></i>
            {{ 'Update' if journal else 'Save' }} Entry
        </button>
    </div>
</form>
{% endif %}
{% endblock %}
